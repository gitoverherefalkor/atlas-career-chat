# n8n Workflow Updates for Report Status Flow

## Overview
The reports table now uses a `status` field to track the report lifecycle. This ensures users can't see their report until after they've completed the AI chat feedback session.

## Status Values

- `processing` - Report is being generated by n8n (initial state)
- `pending_review` - Report generated, user needs to complete AI chat
- `completed` - User completed chat feedback, report is finalized

## Required n8n Workflow Changes

### 1. **Initial Report Creation**
When creating a new report after survey completion:

```javascript
// When inserting the initial report
{
  user_id: "{{$json.user_id}}",
  title: "{{$json.title}}",
  payload: {{$json.payload}},
  status: "processing",  // START with processing
  // ... other fields
}
```

### 2. **After Report Sections are Generated**
Once all report sections are created and saved, update the report status:

```javascript
// Update report status to pending_review
{
  status: "pending_review"  // Signal that report is ready for user chat
}
```

**SQL equivalent:**
```sql
UPDATE reports
SET status = 'pending_review', updated_at = NOW()
WHERE id = '{{report_id}}';
```

### 3. **After Chat Feedback is Incorporated**
Once the user completes the AI chat and feedback is incorporated:

```javascript
// Update report status to completed
{
  status: "completed"  // Report is finalized and can be viewed
}
```

**SQL equivalent:**
```sql
UPDATE reports
SET status = 'completed', updated_at = NOW()
WHERE id = '{{report_id}}';
```

## User Experience Flow

1. **User completes survey** → Report created with status `processing`
   - Dashboard shows: "Your Report is Being Generated" (with loading animation)

2. **n8n generates report sections** → Status updated to `pending_review`
   - Dashboard shows: "Your Report is Ready for Review!" with "Start AI Chat" button
   - User CANNOT see report content yet

3. **User completes AI chat** → Status updated to `completed`
   - Dashboard shows: Full ReportDisplay component
   - User can now view all sections and content

## Testing

To test the flow:

1. Create a report with `status = 'processing'` - Should see loading message
2. Update to `status = 'pending_review'` - Should see chat prompt
3. Update to `status = 'completed'` - Should see full report

## Important Notes

- The `status` column has a CHECK constraint - only accepts: `processing`, `pending_review`, `completed`
- Default status is `processing`
- Users can still access dashboard and profile while report is pending
- The report exists in the database during all stages (not deleted/recreated)
